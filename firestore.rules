rules_version = '2';
service cloud.firestore {
  match /databases/{db}/documents {

    function signedIn() { return request.auth != null; }
    function hasRole(role) {
      return signedIn() && request.auth.token.roles[role] == true;
    }

    // Los usuarios pueden leer y actualizar su propio documento
    match /users/{uid} {
      allow read, update: if signedIn() && request.auth.uid == uid;
      allow create, delete: if hasRole('admin');
    }

    // Cualquiera autenticado puede leer. Las escrituras se hacen vía backend con Admin SDK,
    // o se pueden permitir aquí con lógica fina (ej. solo el owner de la cuenta puede editarla)
    match /{document=**} {
      allow read, write: if signedIn();
    }
  }
}
